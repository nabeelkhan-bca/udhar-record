/* ===== styles.css ===== */

body {
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
  background: #f4f4f4;
}
#app {
  padding: 15px;
  max-width: 480px;
  margin: auto;
}
.title {
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  margin-bottom: 15px;
}
.mode-toggle {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}
.btn {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  background: #ddd;
  border: none;
  font-size: 16px;
  font-weight: bold;
}
.btn.active {
  background: #007bff;
  color: white;
}
.form input {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 15px;
}
.balance-box {
  margin-bottom: 12px;
  font-weight: bold;
  background: #fff;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}
.btn.save {
  background: #28a745;
  color: white;
}
.search-box input {
  width: 100%;
  padding: 12px;
  margin: 15px 0;
  border-radius: 8px;
  border: 1px solid #bbb;
}
.entry-date {
  font-weight: bold;
  margin-top: 15px;
  margin-bottom: 5px;
}
.entry {
  background: #fff;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ddd;
  margin-bottom: 8px;
}
.entry .type {
  font-weight: bold;
}

/* ===== script.js ===== */

let mode = "receive";
let data = JSON.parse(localStorage.getItem("ledgerData") || "[]");

const receiveBtn = document.getElementById("receiveBtn");
const payBtn = document.getElementById("payBtn");
const saveBtn = document.getElementById("saveBtn");
const entriesDiv = document.getElementById("entries");
const searchInput = document.getElementById("searchInput");

receiveBtn.onclick = () => switchMode("receive");
payBtn.onclick = () => switchMode("pay");

function switchMode(m) {
  mode = m;
  receiveBtn.classList.toggle("active", m === "receive");
  payBtn.classList.toggle("active", m === "pay");
}

function getLastBalance(mobile) {
  let list = data.filter(e => e.mobile === mobile);
  if (list.length === 0) return 0;
  return list[list.length - 1].balance;
}

function render() {
  entriesDiv.innerHTML = "";
  let filtered = data.filter(e => {
    let q = searchInput.value.toLowerCase();
    return (
      e.name.toLowerCase().includes(q) ||
      e.mobile.includes(q)
    );
  });

  let grouped = {};
  filtered.forEach(e => {
    if (!grouped[e.date]) grouped[e.date] = [];
    grouped[e.date].push(e);
  });

  Object.keys(grouped).forEach(date => {
    entriesDiv.innerHTML += `<div class='entry-date'>${date}</div>`;
    grouped[date].forEach(e => {
      entriesDiv.innerHTML += `
        <div class='entry'>
          <div class='type'>${e.type.toUpperCase()} - ₹${e.amount}</div>
          <div>${e.name} (${e.mobile})</div>
          <div>Balance: ₹${e.balance}</div>
          <div>${e.remarks}</div>
        </div>
      `;
    });
  });
}

searchInput.oninput = render;

saveBtn.onclick = () => {
  let name = customerName.value.trim();
  let mobile = mobileInput.value.trim();
  let aadhaar = aadhaar.value.trim();
  let amount = Number(amountInput.value.trim());
  let remarks = remarks.value.trim();

  if (!name || !mobile || !amount) return alert("Missing fields");

  let previous = getLastBalance(mobile);
  let newBalance = mode === "receive" ? previous - amount : previous + amount;

  let entry = {
    date: new Date().toLocaleDateString(),
    name,
    mobile,
    aadhaar,
    amount,
    type: mode,
    remarks,
    balance: newBalance
  };

  data.push(entry);
  localStorage.setItem("ledgerData", JSON.stringify(data));

  lastBalance.innerText = newBalance;
  render();
};

mobileInput.oninput = () => {
  lastBalance.innerText = getLastBalance(mobileInput.value);
};

aadhaar.oninput = () => {
  if (aadhaar.value.length === 12) {
    let match = data.find(e => e.aadhaar === aadhaar.value);
    if (match) {
      customerName.value = match.name;
      mobileInput.value = match.mobile;
      lastBalance.innerText = match.balance;
    }
  }
};

render();
